
- route:
    id: langchain4j-http-api
    from:
      uri: platform-http:/chat
      parameters:
        httpMethodRestrict: POST
      steps:
        - log: "Received HTTP request Body: ${body}"
        # - bean: MessageConverter
        - convertBodyTo:
            type: java.lang.String
        - script:
            groovy: |
              import dev.langchain4j.data.message.UserMessage
              return UserMessage.userMessage(exchange.in.body)
        - to:
            id: Chat LLM
            uri: langchain4j-chat
            parameters:
              chatId: httpChat
              chatModel: "#bean:geminiChatModel"
              # chatOperation: CHAT_MULTIPLE_MESSAGES
              lazyStartProducer: "true"

- beans:
    - name: geminiChatModel
      script: |
        import dev.langchain4j.model.googleai.GoogleAiGeminiChatModel
        import dev.langchain4j.model.chat.ChatModel

        return GoogleAiGeminiChatModel.builder()
          .apiKey("AIzaSyARf1E3zznDMvDVxUDnO2NquhbqQfeRTHc")
          .modelName("gemini-1.5-flash")
          .temperature(0.9)
          .maxOutputTokens(3000)
          .build()
      scriptLanguage: groovy
      type: dev.langchain4j.model.chat.ChatModel